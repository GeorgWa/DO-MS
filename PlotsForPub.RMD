---
title: "PlotsForPublication"
author: "Gray Huffman"
date: "September 19, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
#Load Packages
library(dplyr)
library(plyr)
library(ggplot2) 
library(reshape2)
library(RColorBrewer)
```

```{r}
#Global Variables
textVar <- 1
plot_col <- 'royalblue'
plot_fill_col <- 'royalblue'
  
plot_width <- 7
plot_height <- 4
plot_units <- "in"
plot_rez <- 300

```


```{r}
############################################
############################################
#           Clean-up Methods
############################################
############################################

# Reading in data
stageTip <- read.delim('G:/My Drive/2018_QC-MS/Fig_Data/Ids_Along_RT_U937/evidence.txt')

# filter out contaminants
stageTip_nC <- stageTip[ grep("CON", stageTip$Proteins, invert = TRUE) , ]
stageTip_nCnR <- stageTip_nC[ grep("REV", stageTip_nC$Leading.razor.protein, invert = TRUE) , ]

############################################
# Data Subsetting
############################################

# Select Experiments
list_of_ST_exps <- as.data.frame(levels(stageTip_nCnR$Raw.file))
selected_ST_exps <- as.data.frame(list_of_ST_exps[c(1,3,6,7),1])
names(selected_ST_exps) <- "expNames"
stageTip_Selections <- stageTip_nCnR[stageTip_nCnR$Raw.file %in% selected_ST_exps$expNames,]

histdata <- stageTip_Selections[,c("Raw.file","Retention.time","PEP")]
#histdata <- histdata[histdata$PEP < input$slider,]
lengthLev <- length(levels(histdata$Raw.file))

# Renaming Levels
levels(histdata$Raw.file) <- c("Stage Tip 3","ST3b","Stage Tip 2","ST2b","mPOP2","mPOP","Stage Tip 1","ST1b")
maxRT <- max(histdata$Retention.time)

# Changing Factor order
histdata$Raw.file <- factor(histdata$Raw.file,levels=c("Stage Tip 1","ST1b","Stage Tip 2","ST2b","Stage Tip 3","ST3b","mPOP2","mPOP"))

############################################
# Plot generation
############################################

ggplot(histdata, aes(Retention.time)) + facet_wrap(~Raw.file, nrow = 1)+ geom_histogram(bins=100,color=plot_col, fill=plot_fill_col) + coord_flip() +

 theme(panel.background = element_rect(fill = "white",colour = "white"), panel.grid.major = element_line(size = .25, linetype = "solid",color="lightgrey"), panel.grid.minor = element_line(size = .25, linetype = "solid",color="lightgrey"),legend.position="none",axis.text.x = element_text(angle = 45, hjust = 1, margin=margin(r=45)), axis.title=element_text(size=rel(1.2*textVar),face="bold"), axis.text = element_text(size = rel(1.2*textVar)),strip.text = element_text(size=rel(1.2*textVar)), plot.title = element_text(size=20*textVar)) +

xlim(10, maxRT) + xlab("Retention Time (minutes)") + ylab("Number of IDs") + ggtitle("Peptide Identifications by Retention Time")

# Saving Output Figure as .png
ggsave("IDsByRetentionTime.png", width = plot_width, height = plot_height, units = "in", dpi = 300)

```


```{r}
############################################
############################################
#           Chemical Contaminants
############################################
############################################

# Reading in data
contam <- read.delim('G:/My Drive/2018_QC-MS/Fig_Data/PEG_Contam_QC44/allPeptides.txt')


############################################
# Data Subsetting
############################################

# Select Experiments
list_of_Con_exps <- as.data.frame(levels(contam$Raw.file))
selected_Con_exps <- as.data.frame(list_of_Con_exps[c(1,5),1])
names(selected_Con_exps) <- "expNames"
contam_Selections <- contam[contam$Raw.file %in% selected_Con_exps$expNames,]


histdata <- contam_Selections[,c("Raw.file","Charge","Intensity","Retention.time")]
lengthLev <- length(levels(histdata$Raw.file))

histdata <- histdata[histdata$Charge == 1,]
histdata$Retention.time <- floor(histdata$Retention.time)

# Renaming Levels
levels(histdata$Raw.file) <- c("Standard","2","3","4","Contaminated","6","7","8","9","10")
maxRT <- max(histdata$Retention.time)

# Changing Factor order
#histdata$Raw.file <- factor(histdata$Raw.file,levels=c("Stage Tip 1","ST1b","Stage Tip 2","ST2b","Stage Tip 3","ST3b","mPOP2","mPOP"))
ggplot(histdata, aes(x = Retention.time, y = Intensity)) + geom_bar(stat = 'identity', width= 1,color=plot_col, fill=plot_fill_col)+ facet_wrap(~Raw.file, nrow = 1) + coord_flip() + theme(panel.background = element_rect(fill = "white",colour = "white"), panel.grid.major = element_line(size = .25, linetype = "solid",color="lightgrey"), panel.grid.minor = element_line(size = .25, linetype = "solid",color="lightgrey"),legend.position="none",axis.text.x = element_text(angle = 45, hjust = 1, margin=margin(r=45)), axis.title=element_text(size=rel(1.2*textVar),face="bold"), axis.text = element_text(size = rel(1.2*textVar)),strip.text = element_text(size=rel(1.2*textVar)), plot.title = element_text(size=20*textVar)) + xlab("Retention Time (min)") + ylab(expression(bold("Precursor Intensity"))) + ggtitle("Hydrophobicity of Contaminant Ions")


# Saving Output Figure as .png
ggsave("ContamsByRetentionTime.png", width = plot_width, height = plot_height, units = "in", dpi = 300)

```

```{r}
############################################
############################################
#           Apex Offset
############################################
############################################

# Reading in data
apex <- read.delim('G:/My Drive/2018_QC-MS/Fig_Data/Apex_Offset_SQC68/msmsScans.txt')

list_of_Apex_exps <- as.data.frame(levels(apex$Raw.file))
selected_Apex_exps <- as.data.frame(list_of_Apex_exps[c(6,7,8),1])
names(selected_Apex_exps) <- "expNames"
apex_Selections <- apex[apex$Raw.file %in% selected_Apex_exps$expNames,]

histdata <- apex_Selections[,c("Raw.file","Precursor.apex.offset.time")]
lengthLev <- length(levels(histdata$Raw.file))
levels(histdata$Raw.file) <- c("1","2","3","4","5","250ms fill time / Top 3","500ms fill time / Top 3","1000ms fill time / Top 3","9","10","11","12","13","14","15","16","17","18","19","20")
histdata$Precursor.apex.offset.time <- histdata$Precursor.apex.offset.time*60
histdata$Precursor.apex.offset.time[histdata$Precursor.apex.offset.time > 8] <- 9
histdata$Precursor.apex.offset.time[histdata$Precursor.apex.offset.time < -8] <- -9

ggplot(histdata, aes(Precursor.apex.offset.time)) + facet_wrap(~Raw.file, nrow = 1)+ geom_histogram(color=plot_col, fill=plot_fill_col) + coord_flip() + theme(panel.background = element_rect(fill = "white",colour = "white"), panel.grid.major = element_line(size = .25, linetype = "solid",color="lightgrey"), panel.grid.minor = element_line(size = .25, linetype = "solid",color="lightgrey"),legend.position="none",axis.text.x = element_text(angle = 45, hjust = 1, margin=margin(r=45)), axis.title=element_text(size=rel(1.2*textVar),face="bold"), axis.text = element_text(size = rel(1.2*textVar)),strip.text = element_text(size=rel(1.2*textVar)), plot.title = element_text(size=20*textVar)) + xlab("Apex Offset (sec)") + ylab("MS2 Scans") + ggtitle("MS/MS Offset from Apex")
      
# Saving Output Figure as .png
ggsave("ApexOffset.png", width = plot_width, height = plot_height, units = "in", dpi = 300) 
```

